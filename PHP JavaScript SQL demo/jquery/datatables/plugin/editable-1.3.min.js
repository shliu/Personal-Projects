(function(a){a.fn.makeEditable=function(b){function N(){if(L.oFeatures.bServerSide===false){L._iDisplayStart=c;L.oApi._fnCalculateEnd(L);L.oApi._fnDraw(L)}}function M(){return L._iDisplayStart}function K(a){}function J(){return true}function I(a,b,c,d,e,f){}function H(a){return true}function G(a){}function F(a,b,c){return confirm("Are you sure that you want to delete this record?");}function E(b){o.fnEndProcessingMode();var c=a("tr."+o.sSelectedRowClass,i)[0];if(b=="ok"||b==""){i.fnDeleteRow(c);A();N();o.fnOnDeleted("success")}else{o.fnShowError(b,"delete");o.fnOnDeleted("failure")}}function D(b){c=M();if(a("tr."+o.sSelectedRowClass+" td",i).length==0){A();return}var e=d(a("tr."+o.sSelectedRowClass+" td",i)[0]);if(o.fnOnDeleting(a("tr."+o.sSelectedRowClass,i),e,C)){C(e)}}function C(b,c){var d=c;if(c==null)d=o.sDeleteURL;o.fnStartProcessingMode();var e=a.extend(o.oDeleteParameters,{id:b});a.ajax({url:d,type:o.sDeleteHttpMethod,data:e,success:E,dataType:"text",error:function(a){o.fnEndProcessingMode();o.fnShowError(a.responseText,"delete");o.fnOnDeleted("failure")}})}function B(){if(o.oDeleteRowButtonOptions!=null){k.button("option","disabled",false)}else{k.removeAttr("disabled")}}function A(){if(o.oDeleteRowButtonOptions!=null){k.button("option","disabled",true)}else{k.attr("disabled","true")}}function z(b){a(n).validate().resetForm();a(n)[0].reset();a(".error",a(n)).html("");a(".error",a(n)).hide();n.dialog("close");b.stopPropagation();b.preventDefault()}function y(b){o.fnEndProcessingMode();if(o.fnOnNewRowPosted(b)){var c=i.fnSettings();var d=c.aoColumns.length;var e=new Array;a("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],span.datafield[rel]",n).each(function(){var c=a(this).attr("rel");var f="";if(c>=d)o.fnShowError("In the add form is placed input element with the name '"+a(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+d,"add");else{if(this.nodeName.toLowerCase()=="select"||this.tagName.toLowerCase()=="select")f=a("option:selected",this).text();else if(this.nodeName.toLowerCase()=="span"||this.tagName.toLowerCase()=="span")f=a(this).html();else f=this.value;f=f.replace(o.sIDToken,b);e[c]=f}});var f=i.fnAddData(e);var g=i.fnGetNodes(f);v(g);o.fnSetRowID(a(g),b);n.dialog("close");a(n)[0].reset();a(".error",a(n)).html("");N();o.fnOnAdded("success")}}function x(a){return true}function w(b){if(o.fnOnAdding()){if(n.valid()){c=M();o.fnStartProcessingMode();var d=n.serialize();a.ajax({url:o.sAddURL,data:d,type:o.sAddHttpMethod,dataType:"text",success:y,error:function(a){o.fnEndProcessingMode();o.fnShowError(a.responseText,"add");o.fnOnAdded("failure")}})}}b.stopPropagation();b.preventDefault()}function v(b){if(o.bDisableEditing)return;var e={event:"dblclick",callback:function(a,b){o.fnEndProcessingMode();var c="";if(t==a){var d=i.fnGetPosition(this);i.fnUpdate(sNewCellDisplayValue,d[0],d[2]);c="success"}else{var d=i.fnGetPosition(this);i.fnUpdate(s,d[0],d[2]);o.fnShowError(a,"update");c="failure"}o.fnOnEdited(c,s,sNewCellDisplayValue,d[0],d[1],d[2]);if(b.fnOnCellUpdated!=null){b.fnOnCellUpdated(c,a,b)}N()},onsubmit:function(b,c){var d=a("input,select,textarea",this);s=c.revert;t=a("input,select,textarea",a(this)).val();if(d.length==1){var e=d[0];if(e.nodeName.toLowerCase()=="select"||e.tagName.toLowerCase()=="select")sNewCellDisplayValue=a("option:selected",e).text();else sNewCellDisplayValue=t}if(!o.fnOnEditing(d))return false;var f=b;if(b.cssclass!=null){d.addClass(b.cssclass);if(!d.valid()||0==d.valid())return false;else return true}},submitdata:function(a,b){c=M();o.fnStartProcessingMode();var e=d(this);var f=i.fnGetPosition(this)[0];var g=i.fnGetPosition(this)[1];var h=i.fnGetPosition(this)[2];var j=i.fnSettings().aoColumns[h].sName;if(j==null||j=="")j=i.fnSettings().aoColumns[h].sTitle;return{id:e,rowId:f,columnPosition:g,columnId:h,columnName:j}},onerror:function(){o.fnEndProcessingMode();o.fnShowError("Cell cannot be updated(Server error)","update");o.fnOnEdited("failure")},height:o.sEditorHeight,width:o.sEditorWidth};var f=null;if(o.aoColumns!=null){for(var g=0;g<o.aoColumns.length;g++){if(o.aoColumns[g]!=null){f=a("td:nth-child("+(g+1)+")",b);var h=e;h=a.extend({},e,o.aoColumns[g]);var j=o.sUpdateURL;try{if(h.sUpdateURL!=null)j=h.sUpdateURL}catch(k){}f.editable(j,h)}}}else{f=a("td:not(."+o.sReadOnlyCellClass+")",b);f.editable(o.sUpdateURL,e)}}function r(){if(i.fnSettings().oFeatures.bProcessing){a(".dataTables_processing").css("visibility","hidden")}}function q(){if(i.fnSettings().oFeatures.bProcessing){a(".dataTables_processing").css("visibility","visible")}}function p(a,b){alert(a)}function h(b){return a("td:first",b).html()}function g(b,c){a("td:first",b).html(c)}function f(a){return a.attr("id")}function e(a,b){a.attr("id",b)}function d(b){return o.fnGetRowID(a(b.parentNode))}var c=0;var i;var j,k,l,m;var n;var o;var s,t,u;var L;i=this;var O={sUpdateURL:"UpdateData",sAddURL:"AddData",sDeleteURL:"DeleteData",sAddNewRowFormId:"formAddNewRow",oAddNewRowFormOptions:{autoOpen:false,modal:true},sAddNewRowButtonId:"btnAddNewRow",oAddNewRowButtonOptions:null,sAddNewRowOkButtonId:"btnAddNewRowOk",sAddNewRowCancelButtonId:"btnAddNewRowCancel",oAddNewRowOkButtonOptions:{label:"Ok"},oAddNewRowCancelButtonOptions:{label:"Cancel"},sDeleteRowButtonId:"btnDeleteRow",oDeleteRowButtonOptions:null,sSelectedRowClass:"row_selected",sReadOnlyCellClass:"read_only",sAddDeleteToolbarSelector:".add_delete_toolbar",fnShowError:p,fnStartProcessingMode:q,fnEndProcessingMode:r,aoColumns:null,fnOnDeleting:F,fnOnDeleted:G,fnOnAdding:J,fnOnNewRowPosted:x,fnOnAdded:K,fnOnEditing:H,fnOnEdited:I,sAddHttpMethod:"POST",sDeleteHttpMethod:"POST",fnGetRowID:f,fnSetRowID:e,sEditorHeight:"100%",sEditorWidth:"100%",bDisableEditing:false,oDeleteParameters:{},sIDToken:"DATAROWID"};o=a.extend(O,b);L=i.fnSettings();return this.each(function(){if(i.fnSettings().sAjaxSource!=null){i.fnSettings().aoDrawCallback.push({fn:function(){v(i.fnGetNodes());a(i.fnGetNodes()).each(function(){var b=i.fnGetPosition(this);var c=i.fnGetData(b)[0];o.fnSetRowID(a(this),c)})},sName:"fnApplyEditable"})}else{v(i.fnGetNodes())}n=a("#"+o.sAddNewRowFormId);if(n.length!=0){if(o.oAddNewRowFormOptions!=null){o.oAddNewRowFormOptions.autoOpen=false}else{o.oAddNewRowFormOptions={autoOpen:false}}n.dialog(o.oAddNewRowFormOptions);j=a("#"+o.sAddNewRowButtonId);if(j.length!=0){j.click(function(){n.dialog("open")})}else{if(a(o.sAddDeleteToolbarSelector).length==0){throw"Cannot find a button with an id '"+o.sAddNewRowButtonId+"', od placeholder with an id '"+o.sAddDeleteToolbarSelector+"' that should be used for adding new row although form for adding new record is specified"}else{j=null}}if(n[0].nodeName.toLowerCase()=="form"){n.unbind("submit");n.submit(function(a){w(a);return false})}else{a("form",n[0]).unbind("submit");a("form",n[0]).submit(function(a){w(a);return false})}var b=[];l=a("#"+o.sAddNewRowOkButtonId,n);if(l.length==0){if(o.oAddNewRowOkButtonOptions.text==null||o.oAddNewRowOkButtonOptions.text==""){o.oAddNewRowOkButtonOptions.text="Ok"}o.oAddNewRowOkButtonOptions.click=w;o.oAddNewRowOkButtonOptions.id=o.sAddNewRowOkButtonId;b.push(o.oAddNewRowOkButtonOptions)}else{l.click(w)}m=a("#"+o.sAddNewRowCancelButtonId);if(m.length==0){if(o.oAddNewRowCancelButtonOptions.text==null||o.oAddNewRowCancelButtonOptions.text==""){o.oAddNewRowCancelButtonOptions.text="Cancel"}o.oAddNewRowCancelButtonOptions.click=z;o.oAddNewRowCancelButtonOptions.id=o.sAddNewRowCancelButtonId;b.push(o.oAddNewRowCancelButtonOptions)}else{m.click(z)}if(b.length>0){n.dialog("option","buttons",b)}l=a("#"+o.sAddNewRowOkButtonId);m=a("#"+o.sAddNewRowCancelButtonId)}else{n=null}k=a("#"+o.sDeleteRowButtonId);if(k.length!=0)k.click(D);else{k=null}oAddDeleteToolbar=a(o.sAddDeleteToolbarSelector);if(oAddDeleteToolbar.length!=0){if(j==null&&o.sAddNewRowButtonId!=""&&n!=null){oAddDeleteToolbar.append("<button id='"+o.sAddNewRowButtonId+"' class='add_row'>Add</button>");j=a("#"+o.sAddNewRowButtonId);j.click(function(){n.dialog("open")})}if(k==null&&o.sDeleteRowButtonId!=""){oAddDeleteToolbar.append("<button id='"+o.sDeleteRowButtonId+"' class='delete_row'>Delete</button>");k=a("#"+o.sDeleteRowButtonId);k.click(D)}}if(k!=null){if(o.oDeleteRowButtonOptions!=null){k.button(o.oDeleteRowButtonOptions)}A()}if(j!=null){if(o.oAddNewRowButtonOptions!=null){j.button(o.oAddNewRowButtonOptions)}}if(l!=null){if(o.oAddNewRowOkButtonOptions!=null){l.button(o.oAddNewRowOkButtonOptions)}}if(m!=null){if(o.oAddNewRowCancelButtonOptions!=null){m.button(o.oAddNewRowCancelButtonOptions)}}a(".table-action-deletelink",i).live("click",function(b){b.preventDefault();b.stopPropagation();var e=a(this).attr("href");if(e==null||e=="")e=o.sDeleteURL;c=M();var f=a(this).parents("td")[0];var g=a(this).parents("tr")[0];a(g).addClass(o.sSelectedRowClass);var h=d(f);if(o.fnOnDeleting(f,h,C)){C(h,e)}});a("tbody",i).click(function(b){if(a(b.target.parentNode).hasClass(o.sSelectedRowClass)){a(b.target.parentNode).removeClass(o.sSelectedRowClass);if(k!=null){A()}}else{a(i.fnSettings().aoData).each(function(){a(this.nTr).removeClass(o.sSelectedRowClass)});a(b.target.parentNode).addClass(o.sSelectedRowClass);if(k!=null){B()}}})})}})(jQuery)